{% include 'header.html' %}
<div class="container">

    <div class="card text-center">
        <div class="card-header">
            Select your AI model, and enjoy!
        </div>
        <div class="card-body row">

            <div id="choose_img" style="width: 50%; ">
                {% if input_type is not none %}
                <input id="input_type" type="text" style="display: none;" value="{{input_type}}">
                <input id="input_name" type="text" style="display: none;" value="{{input_name}}">
                {% if input_type=="video" %}
                <video style="width: 100%" controls="controls">
                    <source src="{{url_for('static', filename='demo_stuff/' + input_name)}}" type="video/mp4" />
                </video>
                {% endif %}
                {% if input_type=="image" %}
                <img style="width: 100%" src="{{url_for('static', filename='demo_stuff/' + input_name)}}" alt="">
                {% endif %}
                {% endif %}
                <hr>
                <div class="row" style="margin-left: 10%; margin-right: 10%;">
                    <div class="form-check" style="width: 45%; margin-right: 5%">
                        <input class="form-check-input" type="radio" name="flexRadioDefault" id="upload_choice" checked>
                        <label class="form-check-label" for="upload_choice">
                            Upload file to inference
                        </label>
                    </div>
                    <div class="form-check" style="width: 45%; margin-left: 5%;">
                        <input class="form-check-input" type="radio" name="flexRadioDefault" id="cam_choice">
                        <label class="form-check-label" for="cam_choice">
                            Connect to an IP Camera
                        </label>
                    </div>
                </div>

                <img src="" alt="">
                <form action="/upload_file" method="post" enctype="multipart/form-data">
                    <label for="file">Upload File (Video [mp4, avi] / Image [jpg, jpeg, png, bmp])</label>
                    <input class="form-control" type="file" name="file" id="file" onchange="form.submit()">
                </form>
                <br>
                <label for="model_name">Choose your detection model</label>
                <select id="model_name" class="form-select" aria-label="">
                    {% for model_name in models: %}
                    <option value="{{model_name}}">{{model_name}}</option>
                    {% endfor %}
                </select>
                <br>
                <button id="inference_button" onclick="inference()" style="width: 50%;" class="btn btn-success">Run
                    Inference</button>
            </div>
            <div id="predicted_output" style="width: 50%; ">
                <hr>
                <div id="predicted_action" style="display: none;">
                    <a type="button" id="download_output" class="btn btn-primary" style="width: 200px;">Download Output</a>
                    <button class="btn btn-warning" style="width: 200px;">Get Model API</button>
                    <button class="btn btn-info" style="width: 200px;">Export Model Module</button>
                </div>
            </div>
        </div>

    </div>
    <script>
        $("#demo_link").addClass("active");
        function inference() {
            var input_type = $('#input_type').val();
            var input_name = $('#input_name').val();
            var model_name = $('#model_name').val();
            $.ajax({
                type: 'POST',
                url: "{{url_for('infer_detection')}}",
                data: {
                    input_type: input_type,
                    input_name: input_name,
                    model_name: model_name
                },
                success: function (resultData) {
                    console.log(resultData);
                    $("#out_input").remove();
                    if (input_type=="video"){
                        $("#predicted_output").prepend('<video id="out_input" style="width: 100%" controls="controls"><source src="static/predicted/out_'+input_name+'" type="video/mp4" /></video>')
                    }else{
                        $("#predicted_output").prepend('<img id="out_input" style="width: 100%" src="static/predicted/'+input_name+'" alt="">')
                    }
                    $("#predicted_action").css('display', 'block');
                    $("#download_output").attr('href', '/download_file?file_name='+input_name)
                }
            });
        }
    </script>
</div>